<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="default" name="java">

  <echo message="Properties: ${properties}"/>

  <property file="${properties}"/>

  <property name="base" location="${ros.home}/rosjava" />
  <property name="build" location="${base}/build/${ros.package}" />
  <property name="gen-msg" location="${base}/gen/msg/${ros.package}" />
  <property name="gen-srv" location="${base}/gen/srv/${ros.package}" />
  <property name="lib" location="${base}/lib" />
  <property name="jar" location="${lib}/${ros.package}.jar" />

  <path id="classpath">
    <pathelement path="${ros.classpath}" />
  </path>
  <echo message="Classpath: ${ros.classpath}"/>
  
  <target name="default" depends="jar" />

  <target name="init">
    <mkdir dir="${build}" />
    <mkdir dir="${dist}" />
    <mkdir dir="${lib}" />
  </target>

  <target name="clean">
    <delete dir="${gen-msg}" />
    <delete dir="${gen-srv}" />
    <delete dir="${build}" />
    <delete file="${jar}" />
  </target>

  <target name="check-gen-msg-skip">
    <available file="${gen-msg}" type="dir" property="gen-msg.skip" />
  </target>

  <target name="gen-msg" depends="check-gen-msg-skip" unless="gen-msg.skip">
    <exec executable="${ros.rosjava.dir}/scripts/java_msgs.py">
      <arg value="-o ${gen-msg}" />
      <arg value="${ros.package}" />
    </exec>
  </target>

  <target name="check-gen-srv-skip">
    <available file="${gen-srv}" type="dir" property="gen-srv.skip" />
  </target>

  <target name="gen-srv" depends="check-gen-srv-skip" unless="gen-srv.skip">
    <exec executable="${ros.rosjava.dir}/scripts/java_srvs.py">
      <arg value="-o ${gen-srv}" />
      <arg value="${ros.package}" />
    </exec>
  </target>

  <target name="compile" depends="init, gen-msg, gen-srv">
    <javac debug="true" debuglevel="${debuglevel}" destdir="${build}">
      <classpath refid="classpath" />
      <src path="${gen-msg}" />      
      <src path="${gen-srv}" />      
    </javac>
  </target>

  <target name="jar" depends="compile">
    <jar destfile="${jar}">
      <fileset dir="${build}" />
    </jar>
  </target>

</project>
